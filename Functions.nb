(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     79838,       2044]
NotebookOptionsPosition[     78905,       2023]
NotebookOutlinePosition[     79290,       2040]
CellTagsIndexPosition[     79247,       2037]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Structure", " ", "of", " ", "QMC"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"QMC", "=", 
     RowBox[{"Association", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Num", "\[Rule]", "0"}], ",", 
        RowBox[{"Classical", "\[Rule]", 
         RowBox[{"List", "[", "]"}]}], ",", 
        RowBox[{"Quantum", "\[Rule]", 
         RowBox[{"List", "[", "]"}]}]}], "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Initialize", " ", "QMC"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"QMCintialize", "[", 
     RowBox[{"Num0_", ",", "Classical0_", ",", "Quantum0_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Num1", "=", "Num0"}], ",", 
        RowBox[{"Classical1", "=", "Classical0"}], ",", 
        RowBox[{"Quantum1", "=", "Quantum0"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"QMC", "[", "Num", "]"}], "=", "Num1"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"QMC", "[", "Classical", "]"}], "=", "Classical1"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"QMC", "[", "Quantum", "]"}], "=", "Quantum1"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.820734577836856*^9, 3.820734579329417*^9}, {
  3.8207392082839513`*^9, 3.820739209433975*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"78752ef6-1fc3-460a-86b7-3978615af477"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"States2Bra", "[", 
     RowBox[{"QMC0_", ",", "SS0_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"QMC1", "=", "QMC0"}], ",", 
        RowBox[{"SS1", "=", "SS0"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"Idx", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"QMC1", "[", "Classical", "]"}], ",", "SS1"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"num", "=", 
        RowBox[{"QMC1", "[", "Num", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"VectorS", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "\[Equal]", "Idx"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"VectorS", ",", "1"}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"VectorS", ",", "0"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", "VectorS", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Num2Bra", "[", 
     RowBox[{"QMC0_", ",", "Idx0_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"QMC1", "=", "QMC0"}], ",", 
        RowBox[{"Idx1", "=", "Idx0"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"num", "=", 
        RowBox[{"QMC1", "[", "Num", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"VectorS", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "\[Equal]", "Idx1"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"VectorS", ",", "1"}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"VectorS", ",", "0"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "num"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", "VectorS", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Get", " ", "\\", "bra"}], 
    RowBox[{"{", "i", "}"}], " ", "in", " ", "Hilbert", " ", "space"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BraI", "[", "idx0_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"idx1", "=", "idx0"}], "}"}], ",", 
    RowBox[{
     RowBox[{"VectorS", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"i", "\[Equal]", "idx1"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"VectorS", ",", "1"}], "]"}], ",", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"VectorS", ",", "0"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "HilbertD"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", "VectorS", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"isZero", "[", "M_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"M1", "=", "M"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Flag", "=", "True"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"j", "\[NotEqual]", "0"}], ",", 
            RowBox[{
             RowBox[{"Flag", "=", "False"}], ";", "Break"}], ",", 
            "Continue"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "i"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
        ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "M1"}], "}"}]}], "\[IndentingNewLine]", "]"}], ";",
       "\[IndentingNewLine]", "Flag"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ZeroMatrix", "[", "D0_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"D1", "=", "D0"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Id", "=", 
       RowBox[{"IdentityMatrix", "[", "D1", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Id", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "[", 
           RowBox[{"[", "i", "]"}], "]"}], "=", "0"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "D1"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]",
       "Id"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Convert", " ", "variables", " ", "to", " ", "String"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"Var2String", ",", "HoldFirst"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Var2String", "[", "var_", "]"}], ":=", 
    RowBox[{"SymbolName", "[", "var", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetVariables", ":=", 
    RowBox[{"Function", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i", ",", "j"}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"\"\<x\>\"", "<>", 
          RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{"i", ",", "j"}], "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Get", " ", "index", " ", "i", " ", "of", " ", "variable", " ", "xi"}], 
   " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"GetIndex", "[", "sym_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sym1", "=", "sym"}], "}"}], ",", 
    RowBox[{
     RowBox[{"str", "=", 
      RowBox[{"Var2String", "[", "sym1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"idx", "=", 
      RowBox[{"FromDigits", "[", 
       RowBox[{"StringTake", "[", 
        RowBox[{"str", ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", 
           RowBox[{"StringLength", "[", "str", "]"}]}], "}"}]}], "]"}], 
       "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.8207340584678383`*^9, 3.820734101195773*^9}, {
   3.820735024980982*^9, 3.8207350571557884`*^9}, 3.8207351094622383`*^9, {
   3.820735140469496*^9, 3.820735212256751*^9}, {3.8207372498658476`*^9, 
   3.8207372918748536`*^9}, 3.8214136447042923`*^9, 
   3.8215207316803474`*^9},ExpressionUUID->"02854524-8747-4775-bcb2-\
bd7a58774716"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Functions", " ", "that", " ", "appear", " ", "in", " ", "the", " ", 
    "paper"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Convert", " ", "linear", " ", "operator", " ", "to", " ", "vector", " ", 
    "in", " ", "Hilbert", " ", "space"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Linear2Vector", "[", "L0_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"L1", "=", "L0"}], "}"}], ",", 
       RowBox[{
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{"L1", ",", 
          RowBox[{"IdentityMatrix", "[", "HilbertD", "]"}]}], "]"}], ".", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{"KroneckerProduct", "[", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"BraI", "[", "i", "]"}], "]"}], ",", 
            RowBox[{"Transpose", "[", 
             RowBox[{"BraI", "[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "HilbertD"}], "}"}]}], "]"}]}]}], "]"}]}], ";"}],
    "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Vector2Linear", "[", "V0_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"V1", "=", "V0"}], "}"}], ",", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Tr", "[", 
             RowBox[{
              RowBox[{"KroneckerProduct", "[", 
               RowBox[{
                RowBox[{"BraI", "[", "i", "]"}], ",", 
                RowBox[{"BraI", "[", "j", "]"}]}], "]"}], ".", "V1"}], "]"}], 
            "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"BraI", "[", "i", "]"}], "]"}], ".", 
              RowBox[{"BraI", "[", "j", "]"}]}], ")"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "HilbertD"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "HilbertD"}], "}"}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Convert", " ", "linear", " ", "operator", " ", "to", " ", "vector", " ",
       "in", " ", "Classical"}], " ", "-", " ", 
     RowBox[{"Quantum", " ", "composition", " ", "space"}]}], " ", "*)"}], 
   "\n", 
   RowBox[{
    RowBox[{"L2VCQ", "[", 
     RowBox[{"QMC0_", ",", "L0_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"QMC1", "=", "QMC0"}], ",", 
        RowBox[{"L1", "=", "L0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Res", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"VectorS", "=", 
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"States2Bra", "[", 
               RowBox[{"QMC1", ",", 
                RowBox[{"l", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], ",", 
             RowBox[{"Linear2Vector", "[", 
              RowBox[{"l", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Res", "=", 
           RowBox[{"Res", "+", "VectorS"}]}], ";"}], "\[IndentingNewLine]", 
         ",", 
         RowBox[{"{", 
          RowBox[{"l", ",", "L1"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "Res"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"V2LCQ", "[", 
     RowBox[{"QMC0_", ",", "V0_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"QMC1", "=", "QMC0"}], ",", 
        RowBox[{"V1", "=", "V0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"QMC1", "[", "Num", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"states", "=", 
        RowBox[{"QMC1", "[", "Classical", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m", "=", 
        RowBox[{"HilbertD", "*", "HilbertD"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Res", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Quan", "=", 
           RowBox[{"Vector2Linear", "[", 
            RowBox[{"V1", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"1", "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], "*", "m"}]}], ";;", 
               RowBox[{"i", "*", "m"}]}], "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Res", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"states", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "Quan"}], "}"}]}], "]"}], 
          ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "n"}], "}"}]}], "\[IndentingNewLine]", "]"}], ";",
        "\[IndentingNewLine]", "Res"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Get", " ", "the", " ", "super", " ", "operator", " ", "of", " ", "QMC"}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Get2Super", "[", "QMC0_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"QMC1", "=", "QMC0"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"F", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Q1", "=", 
        RowBox[{"QMC1", "[", "Quantum", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"len", "=", 
        RowBox[{"Length", "[", "Q1", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"si", "=", 
           RowBox[{
            RowBox[{"Q1", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"sj", "=", 
           RowBox[{
            RowBox[{"Q1", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Q", "=", 
           RowBox[{
            RowBox[{"Q1", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"class", "=", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"States2Bra", "[", 
              RowBox[{"QMC1", ",", "sj"}], "]"}], "]"}], ".", 
            RowBox[{"States2Bra", "[", 
             RowBox[{"QMC1", ",", "si"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"F", ",", 
            RowBox[{"{", 
             RowBox[{"class", ",", "Q"}], "}"}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "F"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\n", 
   RowBox[{
    RowBox[{"S2M", "[", "Super_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Super1", "=", "Super"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Matrix", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Q", "=", 
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{
             RowBox[{"item", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", 
             RowBox[{"Conjugate", "[", 
              RowBox[{"item", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Matrix", "+=", 
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{
             RowBox[{"item", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "Q"}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"item", ",", "Super1"}], "}"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "Matrix"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ProjKraus", "[", 
      RowBox[{"QMC0_", ",", "T0_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"QMC1", "=", "QMC0"}], ",", 
         RowBox[{"T1", "=", "T0"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Proj", "=", 
         RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Ind", "=", 
         RowBox[{"IdentityMatrix", "[", "HilbertD", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"BraS", "=", 
            RowBox[{"States2Bra", "[", 
             RowBox[{"QMC1", ",", "i"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"class", "=", 
            RowBox[{
             RowBox[{"Transpose", "[", "BraS", "]"}], ".", "BraS"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"Proj", ",", 
             RowBox[{"{", 
              RowBox[{"class", ",", "Ind"}], "}"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "T1"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", "Proj"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"SuperComposite", "[", 
     RowBox[{"SuperA_", ",", "SuperB_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Super1", "=", "SuperA"}], ",", 
        RowBox[{"Super2", "=", "SuperB"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Super3", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"class", "=", 
              RowBox[{
               RowBox[{"i", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ".", 
               RowBox[{"j", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"isZero", "[", "class", "]"}], ",", 
               RowBox[{"Continue", ";"}], ",", 
               RowBox[{
                RowBox[{"Q", "=", 
                 RowBox[{
                  RowBox[{"i", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ".", 
                  RowBox[{"j", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"isZero", "[", "Q", "]"}], ",", 
                  RowBox[{"Continue", ";"}], ",", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"Super3", ",", 
                    RowBox[{"{", 
                    RowBox[{"class", ",", "Q"}], "}"}]}], "]"}]}], "]"}]}]}], 
              "]"}], ";"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "Super1"}], "}"}]}], "\[IndentingNewLine]", 
           "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "Super2"}], "}"}]}], "\[IndentingNewLine]", "]"}],
        ";", "\[IndentingNewLine]", "Super3"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"SuperOperator", "[", 
     RowBox[{"QMC0_", ",", "Superp_", ",", "EE_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"QMC1", "=", "QMC0"}], ",", 
        RowBox[{"Super1", "=", "Superp"}], ",", 
        RowBox[{"E1", "=", "EE"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"class", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Q", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"num", "=", 
        RowBox[{"QMC", "[", "Num", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Result", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Rerange", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"zeromatrix", "=", 
        RowBox[{"ZeroMatrix", "[", "HilbertD", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"class", "=", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"Num2Bra", "[", 
              RowBox[{"QMC1", ",", "i"}], "]"}], "]"}], ".", 
            RowBox[{"Num2Bra", "[", 
             RowBox[{"QMC1", ",", "i"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Rerange", ",", 
            RowBox[{"{", 
             RowBox[{"class", ",", "zeromatrix"}], "}"}]}], "]"}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "num"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"class", "=", 
             RowBox[{
              RowBox[{"q", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ".", 
              RowBox[{"e", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ".", 
              RowBox[{"Transpose", "[", 
               RowBox[{"q", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Q", "=", 
             RowBox[{
              RowBox[{"q", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ".", 
              RowBox[{"e", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ".", 
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{"q", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"isZero", "[", "class", "]"}], ",", "Continue", ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Result", ",", 
                RowBox[{"{", 
                 RowBox[{"class", ",", "Q"}], "}"}]}], "]"}]}], "]"}]}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"q", ",", "Super1"}], "}"}]}], "\[IndentingNewLine]", 
          "]"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"e", ",", "E1"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"len1", "=", 
        RowBox[{"Length", "[", "Result", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"len2", "=", 
        RowBox[{"Length", "[", "Rerange", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Result", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
                RowBox[{
                 RowBox[{"Rerange", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Rerange", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "+=", 
                RowBox[{
                 RowBox[{"Result", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", "Continue"}], "]"}], 
             ";"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "len2"}], "}"}]}], "\[IndentingNewLine]", 
           "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "len1"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", "Rerange"}]}], "\[IndentingNewLine]", 
     "]"}]}], "\n", "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Supp", "[", "M_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"M1", "=", "M"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"eigenvectors", "=", 
        RowBox[{"Eigenvectors", "[", "M1", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"eigenvalues", "=", 
        RowBox[{"Eigenvalues", "[", "M1", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"SupportVectors", "=", 
        RowBox[{"Pick", "[", 
         RowBox[{"eigenvectors", ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "\[NotEqual]", "0"}], "&"}], ",", "eigenvalues"}], 
           "]"}]}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"rho", " ", "is", " ", "of", " ", "the", " ", "form", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<s0\>\"", ",", "Q0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<s1\>\"", ",", "Q1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<s2\>\"", ",", "Q2"}], "}"}], ",", " ", "..."}], "}"}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PlusDesity", "[", 
     RowBox[{"QMC0_", ",", "rho1_", ",", "rho2_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"QMC1", "=", "QMC0"}], ",", 
        RowBox[{"rhoa", "=", "rho1"}], ",", 
        RowBox[{"rhob", "=", "rho2"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rhoc", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ZeroList", "=", 
        RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Q", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"rhoc", ",", 
            RowBox[{"{", 
             RowBox[{"si", ",", "Q"}], "}"}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"si", ",", 
           RowBox[{"QMC1", "[", "Classical", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"rhoa", "=", 
        RowBox[{"Union", "[", 
         RowBox[{"rhoa", ",", "rhob"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"a", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
               RowBox[{
                RowBox[{"rhoc", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"rhoc", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+=", 
               RowBox[{"a", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", "Continue"}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "rhoc", "]"}]}], "}"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "rhoa"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"rhoc", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "==", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ZeroList", ",", 
             RowBox[{"{", "i", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
           "Continue"}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "rhoc", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"rhoc", "=", 
        RowBox[{"Delete", "[", 
         RowBox[{"rhoc", ",", "ZeroList"}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TrClassical", "[", 
     RowBox[{"QMC0_", ",", "S2M0_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"QMC1", "=", "QMC0"}], ",", 
        RowBox[{"S2M1", "=", "S2M0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m", "=", 
        RowBox[{"HilbertD", "*", "HilbertD"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Res", "=", 
        RowBox[{"ZeroMatrix", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Res", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "+=", 
                 RowBox[{
                  RowBox[{"S2M1", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", 
                    RowBox[{"k", "*", "m"}]}], "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"j", "+", 
                    RowBox[{"k", "*", "m"}]}], "]"}], "]"}]}], ";"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "0", ",", 
                 RowBox[{
                  RowBox[{"QMC", "[", "Num", "]"}], "-", "1"}]}], "}"}]}], 
              "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "m"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
          ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "m"}], "}"}]}], "\[IndentingNewLine]", "]"}], ";",
        "\[IndentingNewLine]", "Res"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.8207342452506914`*^9, 3.8207342467298527`*^9}, {
  3.8207342955284877`*^9, 3.8207342959663205`*^9}, {3.820735109491161*^9, 
  3.820735109551998*^9}, {3.820735275308998*^9, 3.820735368136819*^9}, {
  3.820735432080773*^9, 3.8207355963198524`*^9}, {3.820737317218416*^9, 
  3.820737458019418*^9}, {3.820737492183654*^9, 3.8207376301948414`*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"cde8862e-cb1d-4f81-9aeb-112537ee5155"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ComputeBSCC", "[", 
   RowBox[{"QMC0_", ",", "Super_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"Super1", "=", "Super"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SuperX", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"num", "=", 
      RowBox[{"QMC1", "[", "Num", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"All", " ", "the", " ", "diagonal", " ", "variables"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"DiagVars", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Diagonal", " ", "Variables", " ", "have", " ", "been", " ", 
       "assigned"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"DiagAssign", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"AssignList", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"VarList", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", "FreeVariables", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"FreeList", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"FreeVariables", " ", "in", " ", "solving", " ", "result"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Freeres", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Result", " ", "List"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ResultList", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{"GetVariables", "[", 
       RowBox[{"1", ",", 
        RowBox[{"num", "*", 
         RowBox[{"HilbertD", "^", "2"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"class", "=", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"Num2Bra", "[", 
            RowBox[{"QMC1", ",", "i"}], "]"}], "]"}], ".", 
          RowBox[{"Num2Bra", "[", 
           RowBox[{"QMC1", ",", "i"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"T", "=", 
         RowBox[{"IdentityMatrix", "[", "HilbertD", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"idx", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], "*", 
                 RowBox[{"HilbertD", "^", "2"}]}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"j", "-", "1"}], ")"}], "*", "HilbertD"}], "+", 
                "k"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"VarList", ",", 
                RowBox[{"A", "[", 
                 RowBox[{"[", "idx", "]"}], "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"j", "\[Equal]", "k"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"T", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "=", 
                  RowBox[{"A", "[", 
                   RowBox[{"[", "idx", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"DiagVars", ",", 
                   RowBox[{"A", "[", 
                    RowBox[{"[", "idx", "]"}], "]"}]}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"T", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "=", 
                  RowBox[{
                   RowBox[{"A", "[", 
                    RowBox[{"[", "idx", "]"}], "]"}], "+", 
                   RowBox[{"I", " ", 
                    RowBox[{"A", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    RowBox[{"HilbertD", "^", "2"}]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"k", "-", "1"}], ")"}], "*", "HilbertD"}], "+", 
                    "j"}], "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"T", "[", 
                    RowBox[{"[", "k", "]"}], "]"}], "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "=", 
                  RowBox[{
                   RowBox[{"A", "[", 
                    RowBox[{"[", "idx", "]"}], "]"}], "-", 
                   RowBox[{"I", " ", 
                    RowBox[{"A", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    RowBox[{"HilbertD", "^", "2"}]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"k", "-", "1"}], ")"}], "*", "HilbertD"}], "+", 
                    "j"}], "]"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"VarList", ",", 
                   RowBox[{"A", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", 
                    RowBox[{"HilbertD", "^", "2"}]}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"k", "-", "1"}], ")"}], "*", "HilbertD"}], "+", 
                    "j"}], "]"}], "]"}]}], "]"}]}]}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "j"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "HilbertD"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"SuperX", ",", 
          RowBox[{"{", 
           RowBox[{"class", ",", "T"}], "}"}]}], "]"}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "num"}], "}"}]}], "\[IndentingNewLine]", "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"Y", "=", 
      RowBox[{"SuperOperator", "[", 
       RowBox[{"QMC1", ",", "Super1", ",", "SuperX"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Expr", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Yi", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
             RowBox[{"SuperXi", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Expr", ",", 
              RowBox[{
               RowBox[{"Yi", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
               RowBox[{"SuperXi", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ",", "Continue"}], 
           "]"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"Yi", ",", "Y"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
        ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"SuperXi", ",", "SuperX"}], "}"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"AppendTo", "[", 
        RowBox[{"Expr", ",", 
         RowBox[{"trace", "\[Equal]", "1"}]}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Res", "=", 
      RowBox[{"Solve", "[", "Expr", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"SuperX", "=", 
      RowBox[{"SuperX", "/.", "Res"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Extract", " ", "all", " ", "the", " ", "diagonal", " ", "free", " ", 
       "variables"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"AssignList", ",", 
          RowBox[{"item", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"idx", "=", 
         RowBox[{"GetIndex", "[", 
          RowBox[{"item", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"i", "=", 
         RowBox[{"Ceiling", "[", 
          RowBox[{"idx", "/", 
           RowBox[{"HilbertD", "^", "2"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"j", "=", 
         RowBox[{"Ceiling", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"idx", "-", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}], "*", 
              RowBox[{"HilbertD", "^", "2"}]}]}], ")"}], "/", "HilbertD"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"kmod", "=", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"idx", "-", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}], "*", 
              RowBox[{"HilbertD", "^", "2"}]}]}], ")"}], ",", "HilbertD"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"kmod", "\[Equal]", "0"}], ",", 
          RowBox[{"k", "=", "HilbertD"}], ",", 
          RowBox[{"k", "=", "kmod"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"j", "\[Equal]", "k"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"DiagAssign", ",", 
            RowBox[{"item", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", "Continue"}], 
         "]"}], ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"item", ",", 
         RowBox[{"Res", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Find", " ", "free", " ", 
       RowBox[{"variables", ":", 
        RowBox[{
         RowBox[{"diagonal", " ", "list"}], "-", 
         RowBox[{"result", " ", "diagonal", " ", "list"}]}]}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"FreeList", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"DiagVars", ",", 
        RowBox[{"Intersection", "[", 
         RowBox[{"DiagVars", ",", "DiagAssign"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Find", " ", "variables", " ", "that", " ", "are", " ", "neither", " ", 
       "appearing", " ", "in", " ", "the", " ", "result", " ", "nor", " ", 
       "free", " ", "variables"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Unrelevent", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"VarList", ",", 
        RowBox[{"Union", "[", 
         RowBox[{"AssignList", ",", "FreeList"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Assign", " ", "unrelevent", " ", "variables", " ", "to", " ", "0"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"values", "=", 
      RowBox[{"{", "0", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"val1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Thread", "[", 
         RowBox[{"Unrelevent", "\[Rule]", "#"}], "]"}], "&"}], "/@", 
       "values"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"len3", "=", 
      RowBox[{"Length", "[", "FreeList", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"SolVector", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"SolVector", ",", "0"}], "]"}], ";"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "len3"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SolVector", "=", 
      RowBox[{"{", "SolVector", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"DensityList", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"T", "=", 
         RowBox[{"ZeroMatrix", "[", "HilbertD", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"DensityList", ",", "T"}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "num"}], "}"}]}], "\[IndentingNewLine]", "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"StateList", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"class", "=", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"Num2Bra", "[", 
            RowBox[{"QMC1", ",", "i"}], "]"}], "]"}], ".", 
          RowBox[{"Num2Bra", "[", 
           RowBox[{"QMC1", ",", "i"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"StateList", ",", 
          RowBox[{"Rule", "[", 
           RowBox[{"class", ",", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "num"}], "}"}]}], "\[IndentingNewLine]", "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"SuppList", "=", 
      RowBox[{"Association", "[", "StateList", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"val2", "=", 
         RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"SolVector", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", "1"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"val2", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"FreeList", "\[Rule]", "#"}], "]"}], "&"}], "/@", 
          "SolVector"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"val2", "=", 
         RowBox[{"{", 
          RowBox[{"Union", "[", 
           RowBox[{
            RowBox[{"val1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"val2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SuperT", "=", 
         RowBox[{"SuperX", "/.", "val2"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"SuperT", "=", 
         RowBox[{
          RowBox[{"SuperT", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"class", "=", 
            RowBox[{"item", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Q", "=", 
            RowBox[{"item", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"SuppQ", "=", 
            RowBox[{"Supp", "[", "Q", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"SuppList", "[", "class", "]"}], "=", 
            RowBox[{"Union", "[", 
             RowBox[{
              RowBox[{"SuppList", "[", "class", "]"}], ",", "SuppQ"}], 
             "]"}]}], ";"}], ",", 
          RowBox[{"{", 
           RowBox[{"item", ",", "SuperT"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"SolVector", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", "0"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "len3"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"SuppList", "=", 
      RowBox[{"Normal", "[", "SuppList", "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.820737225992375*^9, {3.820737658642621*^9, 3.820737783986228*^9}, 
   3.820879213921962*^9, {3.820879316337143*^9, 3.820879369943654*^9}, {
   3.8208797624699383`*^9, 3.8208797927601347`*^9}, {3.8208799565951285`*^9, 
   3.820879956897477*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"d23fec29-6599-49bd-96df-4dc370dc8b38"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ComplementSpace", "[", "BSCC0_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"BSCC1", "=", "BSCC0"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SuperComplete", "=", 
      RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"item", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"Q", "=", 
           RowBox[{"IdentityMatrix", "[", "HilbertD", "]"}]}], ",", 
          RowBox[{"Q", "=", 
           RowBox[{"Orthogonalize", "[", 
            RowBox[{"NullSpace", "[", 
             RowBox[{"item", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Q", "\[Equal]", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"Q", "=", 
           RowBox[{"ZeroMatrix", "[", "HilbertD", "]"}]}], ",", 
          RowBox[{"Q", "=", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{"{", "vi", "}"}], "]"}], ".", 
              RowBox[{"{", "vi", "}"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"vi", ",", "Q"}], "}"}]}], "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"SuperComplete", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"item", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "Q"}], "}"}]}], "]"}]}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"item", ",", "BSCC1"}], "}"}]}], "\[IndentingNewLine]", "]"}],
      ";", "\[IndentingNewLine]", "SuperComplete"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.8208796778322964`*^9, 3.820879734397888*^9}, {
  3.820879767128637*^9, 3.820879820221225*^9}},
 CellLabel->
  "In[199]:=",ExpressionUUID->"5e14d12d-ad3e-4de4-a54f-f338aac90d49"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ReachSOVM", "[", 
   RowBox[{"QMC0_", ",", "T0_", ",", "Initial0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"T1", "=", "T0"}], ",", 
      RowBox[{"Initial1", "=", "Initial0"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"states", "=", 
      RowBox[{"QMC1", "[", "Classical", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"statesN", "=", 
      RowBox[{"QMC1", "[", "Num", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Id1", "=", 
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"HilbertD", "*", "HilbertD"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Id2", "=", 
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"statesN", "*", "HilbertD", "*", "HilbertD"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Sinit", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"States2Bra", "[", 
        RowBox[{"QMC1", ",", "Initial1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"F", "=", 
      RowBox[{"Get2Super", "[", "QMC1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NotT", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"states", ",", "T1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ProjNotT", "=", 
      RowBox[{"ProjKraus", "[", 
       RowBox[{"QMC1", ",", "NotT"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"FNotT", "=", 
      RowBox[{"SuperComposite", "[", 
       RowBox[{"F", ",", "ProjNotT"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"BSCC", "=", 
      RowBox[{"ComputeBSCC", "[", 
       RowBox[{"QMC1", ",", "FNotT"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"PNotGamma", "=", 
      RowBox[{"ComplementSpace", "[", "BSCC", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"M2", "=", 
      RowBox[{"S2M", "[", 
       RowBox[{"SuperComposite", "[", 
        RowBox[{"FNotT", ",", "PNotGamma"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"M3", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"M3", "+=", 
         RowBox[{"KroneckerProduct", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"States2Bra", "[", 
              RowBox[{"QMC1", ",", "si"}], "]"}], "]"}], ".", 
            RowBox[{"States2Bra", "[", 
             RowBox[{"QMC1", ",", "si"}], "]"}]}], ",", "Id1"}], "]"}]}], 
        ";"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"si", ",", "T1"}], "}"}]}], "\[IndentingNewLine]", "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Det", "[", 
         RowBox[{"Id2", "-", "M2"}], "]"}], "\[NotEqual]", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Delta", "=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"KroneckerProduct", "[", 
             RowBox[{
              RowBox[{"States2Bra", "[", 
               RowBox[{"QMC1", ",", "si"}], "]"}], ",", "Id1"}], "]"}], ".", 
            "M3", ".", 
            RowBox[{"Inverse", "[", 
             RowBox[{"Id2", "-", "M2"}], "]"}], ".", 
            RowBox[{"KroneckerProduct", "[", 
             RowBox[{"Sinit", ",", "Id1"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"si", ",", "states"}], "}"}]}], "]"}]}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<Error\>\"", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "Delta"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ReachPOVM", "[", 
   RowBox[{"QMC0_", ",", "T0_", ",", "Initial0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"T1", "=", "T0"}], ",", 
      RowBox[{"Initial1", "=", "Initial0"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Delta", "=", 
      RowBox[{"ReachSOVM", "[", 
       RowBox[{"QMC1", ",", "T1", ",", "Initial1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Vector2Linear", "[", 
      RowBox[{
       RowBox[{"ConjugateTranspose", "[", "Delta", "]"}], ".", 
       RowBox[{"Linear2Vector", "[", 
        RowBox[{"IdentityMatrix", "[", "HilbertD", "]"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SafetyPOVM", "[", 
   RowBox[{"QMC0_", ",", "T0_", ",", "Initial0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"T1", "=", "T0"}], ",", 
      RowBox[{"Initial1", "=", "Initial0"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IdentityMatrix", "[", "HilbertD", "]"}], "-", 
     RowBox[{"ReachPOVM", "[", 
      RowBox[{"QMC1", ",", "T1", ",", "Initial1"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"isConvgt", "[", 
   RowBox[{"QMC0_", ",", "T0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"T1", "=", "T0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"F", "=", 
      RowBox[{"Get2Super", "[", "QMC1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"NotT", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"QMC1", "[", "Classical", "]"}], ",", "T1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"FNotT", "=", 
      RowBox[{"SuperComposite", "[", 
       RowBox[{"F", ",", 
        RowBox[{"ProjKraus", "[", 
         RowBox[{"QMC1", ",", "NotT"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"M", "=", 
      RowBox[{"S2M", "[", "FNotT", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Val", "=", 
      RowBox[{"Eigenvalues", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Flag", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Norm", "[", "i", "]"}], "\[Equal]", "1"}], "&&", " ", 
          RowBox[{"i", "\[NotEqual]", "1"}]}], ",", 
         RowBox[{"Flag", "=", "False"}], ",", "Continue"}], "]"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "Val"}], "}"}]}], "\[IndentingNewLine]", "]"}], ";",
      "\[IndentingNewLine]", "Flag"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"isConvgtwithInit", "[", 
   RowBox[{"QMC0_", ",", "T0_", ",", "RhoCQ0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"T1", "=", "T0"}], ",", 
      RowBox[{"RhoCQ1", "=", "RhoCQ0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"isConvgt", "[", 
        RowBox[{"QMC1", ",", "T1"}], "]"}], ",", 
       RowBox[{"Flag", "=", "True"}], ",", 
       RowBox[{
        RowBox[{"F", "=", 
         RowBox[{"Get2Super", "[", "QMC1", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"NotT", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"QMC1", "[", "Classical", "]"}], ",", "T1"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"FNotT", "=", 
         RowBox[{"SuperComposite", "[", 
          RowBox[{"F", ",", 
           RowBox[{"ProjKraus", "[", 
            RowBox[{"QMC1", ",", "NotT"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"M", "=", 
         RowBox[{"S2M", "[", "FNotT", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"S", ",", "J"}], "}"}], "=", 
         RowBox[{"JordanDecomposition", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Dim", "=", 
         RowBox[{"Dimensions", "[", "J", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"L2V", "=", 
         RowBox[{"L2VCQ", "[", 
          RowBox[{"QMC1", ",", "RhoCQ1"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"NonConvgtV", "=", 
         RowBox[{"List", "[", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Norm", "[", 
                RowBox[{
                 RowBox[{"J", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "\[Equal]", "1"}], "&&", 
              RowBox[{
               RowBox[{
                RowBox[{"J", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "1"}]}], ",", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"NonConvgtV", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Transpose", "[", "S", "]"}], "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "}"}]}], "]"}], ",", 
             "Continue"}], "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "Dim"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Flag", "=", "True"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"res", "=", 
            RowBox[{"v", ".", "L2V"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"res", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "0"}], ",", 
             RowBox[{"Continue", ";"}], ",", 
             RowBox[{"Flag", "=", "False"}]}], "]"}]}], "\[IndentingNewLine]",
           ",", 
          RowBox[{"{", 
           RowBox[{"v", ",", "NonConvgtV"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "Flag"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SafetySOVM", "[", 
   RowBox[{"QMC0_", ",", "T0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"T1", "=", "T0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"isConvgt", "[", 
        RowBox[{"QMC1", ",", "T1"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"F", "=", 
         RowBox[{"Get2Super", "[", "QMC1", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"NotT", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"QMC1", "[", "Classical", "]"}], ",", "T1"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"FNotT", "=", 
         RowBox[{"SuperComposite", "[", 
          RowBox[{"F", ",", 
           RowBox[{"ProjKraus", "[", 
            RowBox[{"QMC1", ",", "NotT"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"M", "=", 
         RowBox[{"S2M", "[", "FNotT", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"S", ",", "J"}], "}"}], "=", 
         RowBox[{"JordanDecomposition", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Res", "=", 
         RowBox[{"Limit", "[", 
          RowBox[{
           RowBox[{"S", ".", 
            RowBox[{"MatrixPower", "[", 
             RowBox[{"J", ",", "p"}], "]"}], ".", 
            RowBox[{"Inverse", "[", "S", "]"}]}], ",", 
           RowBox[{"p", "\[Rule]", "Infinity"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"TrClassical", "[", "Res", "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<Error\>\"", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SafetySOVMwithInit", "[", 
   RowBox[{"QMC0_", ",", "T0_", ",", "RhoCQ0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"T1", "=", "T0"}], ",", 
      RowBox[{"RhoCQ1", "=", "RhoCQ0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"isConvgtwithInit", "[", 
        RowBox[{"QMC1", ",", "T1", ",", "RhoCQ1"}], "]"}], ",", 
       RowBox[{
        RowBox[{"F", "=", 
         RowBox[{"Get2Super", "[", "QMC1", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"NotT", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"QMC1", "[", "Classical", "]"}], ",", "T1"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"FNotT", "=", 
         RowBox[{"SuperComposite", "[", 
          RowBox[{"F", ",", 
           RowBox[{"ProjKraus", "[", 
            RowBox[{"QMC1", ",", "NotT"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"M", "=", 
         RowBox[{"S2M", "[", "FNotT", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"S", ",", "J"}], "}"}], "=", 
         RowBox[{"JordanDecomposition", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Res", "=", 
         RowBox[{"Limit", "[", 
          RowBox[{
           RowBox[{"S", ".", 
            RowBox[{"MatrixPower", "[", 
             RowBox[{"J", ",", "p"}], "]"}], ".", 
            RowBox[{"Inverse", "[", "S", "]"}], ".", 
            RowBox[{"L2VCQ", "[", 
             RowBox[{"QMC1", ",", "RhoCQ1"}], "]"}]}], ",", 
           RowBox[{"p", "\[Rule]", "Infinity"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"V2LCQ", "[", 
          RowBox[{"QMC1", ",", "Res"}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<Error\>\"", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Prob", "[", 
   RowBox[{"POVM0_", ",", "M0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"POVM1", "=", "POVM0"}], ",", 
      RowBox[{"M1", "=", "M0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Flag", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"eigenV", "=", 
      RowBox[{"Eigenvalues", "[", 
       RowBox[{"M1", "-", "POVM1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"v", "<", "0"}], ",", 
          RowBox[{"Flag", "=", "False"}], ",", "Continue"}], "]"}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"v", ",", "eigenV"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", "Flag"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ProbwithInit", "[", 
   RowBox[{"POVM0_", ",", "M0_", ",", "Rho0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"POVM1", "=", "POVM0"}], ",", 
      RowBox[{"M1", "=", "M0"}], ",", 
      RowBox[{"Rho1", "=", "Rho0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"V", "=", 
      RowBox[{"Tr", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"M1", "-", "POVM1"}], ")"}], ".", "Rho1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Flag", "=", 
      RowBox[{"(", 
       RowBox[{"V", "\[GreaterEqual]", "0"}], ")"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FidelitywithInit", "[", 
   RowBox[{"S2M0_", ",", "Tau0_", ",", "Rho0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"S2M1", "=", "S2M0"}], ",", 
      RowBox[{"Tau1", "=", "Tau0"}], ",", 
      RowBox[{"Rho1", "=", "Rho0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ResM", "=", 
      RowBox[{
       RowBox[{"MatrixFunction", "[", 
        RowBox[{"Sqrt", ",", "Rho1"}], "]"}], ".", 
       RowBox[{"Vector2Linear", "[", 
        RowBox[{"S2M1", ".", 
         RowBox[{"Linear2Vector", "[", "Rho1", "]"}]}], "]"}], ".", 
       RowBox[{"MatrixFunction", "[", 
        RowBox[{"Sqrt", ",", "Rho1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Res", "=", 
      RowBox[{"Tr", "[", 
       RowBox[{"MatrixFunction", "[", 
        RowBox[{"Sqrt", ",", "ResM"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Flag", "=", 
      RowBox[{"(", 
       RowBox[{"Res", "\[LessEqual]", "Tau1"}], ")"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8207342759086237`*^9, 3.8207342763155403`*^9}, {
   3.820734315140139*^9, 3.8207343549980907`*^9}, {3.8207346876961164`*^9, 
   3.8207346925557346`*^9}, {3.820735109576932*^9, 3.820735109634777*^9}, {
   3.820735353576738*^9, 3.820735368156765*^9}, {3.8207377980033035`*^9, 
   3.8207378094607897`*^9}, {3.820822927696311*^9, 3.8208229465617976`*^9}, 
   3.820825471919258*^9, {3.8208798497725177`*^9, 3.8208798960103936`*^9}},
 CellLabel->
  "In[200]:=",ExpressionUUID->"51141f9f-816e-492c-b575-fc2f1c1ce95c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"GetVariablesU", ":=", 
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "j"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"ToExpression", "[", 
        RowBox[{"\"\<u\>\"", "<>", 
         RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "&"}], "/@", 
      RowBox[{"Range", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetVariablesV", ":=", 
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "j"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"ToExpression", "[", 
        RowBox[{"\"\<v\>\"", "<>", 
         RowBox[{"ToString", "[", "#", "]"}]}], "]"}], "&"}], "/@", 
      RowBox[{"Range", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Fidelity", "[", 
   RowBox[{"QMC0_", ",", "S2M0_", ",", "Tau0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"QMC1", "=", "QMC0"}], ",", 
      RowBox[{"S2M1", "=", "S2M0"}], ",", 
      RowBox[{"Tau1", "=", "Tau0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Flag", "=", "False"}], ";", "\[IndentingNewLine]", 
     RowBox[{"F", "=", 
      RowBox[{"Get2Super", "[", "QMC1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"bscc", "=", 
      RowBox[{"ComputeBSCC", "[", 
       RowBox[{"QMC1", ",", "F"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"Initial", " ", "state", " ", "is", " ", "s0"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Initial", "=", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"States2Bra", "[", 
         RowBox[{"QMC", ",", "\"\<s0\>\""}], "]"}], "]"}], ".", 
       RowBox[{"States2Bra", "[", 
        RowBox[{"QMC", ",", "\"\<s0\>\""}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"i", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "Initial"}], ",", 
         RowBox[{"Flag", "=", "True"}], ",", "Continue"}], "]"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "bscc"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", "Flag"}], ",", 
       RowBox[{"Print", "[", "Flag", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"U", "=", 
         RowBox[{"GetVariablesU", "[", 
          RowBox[{"1", ",", "HilbertD"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"V", "=", 
         RowBox[{"GetVariablesV", "[", 
          RowBox[{"1", ",", "HilbertD"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Val", "=", 
         RowBox[{"Union", "[", 
          RowBox[{"U", ",", "V"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"norm", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"norm", "+=", 
            RowBox[{
             RowBox[{
              RowBox[{"U", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "^", "2"}], "+", 
             RowBox[{
              RowBox[{"V", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "^", "2"}]}]}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "HilbertD"}], "}"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"BraV", "=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"U", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 RowBox[{"U", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "-", 
                RowBox[{
                 RowBox[{"V", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 RowBox[{"U", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "I"}], "+", 
                RowBox[{
                 RowBox[{"V", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], 
                 RowBox[{"U", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "I"}], "+", 
                RowBox[{
                 RowBox[{"V", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 RowBox[{"V", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}]}], ")"}], 
              RowBox[{"KroneckerProduct", "[", 
               RowBox[{
                RowBox[{"BraI", "[", "i", "]"}], ",", 
                RowBox[{"BraI", "[", "j", "]"}]}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "HilbertD"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "HilbertD"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"KetV", "=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"U", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 RowBox[{"U", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "-", 
                RowBox[{
                 RowBox[{"U", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 RowBox[{"V", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "I"}], "+", 
                RowBox[{
                 RowBox[{"U", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], 
                 RowBox[{"V", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "I"}], "+", 
                RowBox[{
                 RowBox[{"V", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], 
                 RowBox[{"V", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}]}], ")"}], 
              RowBox[{"KroneckerProduct", "[", 
               RowBox[{
                RowBox[{"Transpose", "[", 
                 RowBox[{"BraI", "[", "i", "]"}], "]"}], ",", 
                RowBox[{"Transpose", "[", 
                 RowBox[{"BraI", "[", "j", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "HilbertD"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "HilbertD"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Fid", "=", 
         RowBox[{"Simplify", "[", 
          RowBox[{"Tr", "[", 
           RowBox[{"BraV", ".", "S2M1", ".", "KetV"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Flag", "=", 
         RowBox[{"Reduce", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Exists", "[", 
               RowBox[{"#", ",", 
                RowBox[{
                 RowBox[{"Element", "[", 
                  RowBox[{"#", ",", "Reals"}], "]"}], "&&", 
                 RowBox[{"norm", "\[Equal]", "1"}], "&&", 
                 RowBox[{"Fid", "\[LessEqual]", 
                  RowBox[{"Tau1", "^", "2"}]}]}]}], "]"}], "&"}], "/@", 
             RowBox[{"{", "Val", "}"}]}], ")"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]",
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.820734365648238*^9, 3.8207343659813595`*^9}, {
   3.8207351096500206`*^9, 3.8207351096587133`*^9}, 3.820806682578642*^9, {
   3.820806757368725*^9, 3.820806764624914*^9}, {3.820878323505544*^9, 
   3.820878324484842*^9}},
 CellLabel->
  "In[141]:=",ExpressionUUID->"4c73eeb0-ab1e-4dc4-af28-8b72aa51261d"]
},
WindowSize->{1536, 781},
WindowMargins->{{-8, Automatic}, {Automatic, 0}},
Magnification:>1.3 Inherited,
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (2018\:5e743\:67086\
\:65e5)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1622, 43, 282, "Input",ExpressionUUID->"78752ef6-1fc3-460a-86b7-3978615af477"],
Cell[2183, 65, 7086, 198, 1431, "Input",ExpressionUUID->"02854524-8747-4775-bcb2-bd7a58774716"],
Cell[9272, 265, 24181, 603, 5425, "Input",ExpressionUUID->"cde8862e-cb1d-4f81-9aeb-112537ee5155"],
Cell[33456, 870, 17338, 426, 3579, "Input",ExpressionUUID->"d23fec29-6599-49bd-96df-4dc370dc8b38"],
Cell[50797, 1298, 2218, 57, 395, "Input",ExpressionUUID->"5e14d12d-ad3e-4de4-a54f-f338aac90d49"],
Cell[53018, 1357, 17946, 460, 3876, "Input",ExpressionUUID->"51141f9f-816e-492c-b575-fc2f1c1ce95c"],
Cell[70967, 1819, 7934, 202, 1021, "Input",ExpressionUUID->"4c73eeb0-ab1e-4dc4-af28-8b72aa51261d"]
}
]
*)

